version: 1
dashboard:
  id: clickhouse-monitoring
  title: ClickHouse Monitoring
  description: ClickHouse query, replication, and storage metrics.
  tags: [clickhouse, monitoring]
  vars:
    - name: svc
      type: SVC
    - name: service_instance_id
      type: TAG_VALUE
      tag: service_instance_id
  rows:
    - id: clickhouse-queries
      title: Query Activity
      panels:
        - id: queries-total
          title: Queries Total
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_queries_total","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: queries-failed
          title: Queries Failed
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_queries_failed","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: query-read-rows
          title: Query Read Rows
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_query_read_rows","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: query-written-rows
          title: Query Written Rows
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_query_written_rows","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: query-read-bytes
          title: Query Read Bytes
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_query_read_bytes","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: query-written-bytes
          title: Query Written Bytes
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_query_written_bytes","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: clickhouse-concurrency
      title: Concurrency
      panels:
        - id: current-connections
          title: Current Connections
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_current_connections","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: current-queries
          title: Current Queries
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_current_queries","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: query-queue
          title: Query Queue Size
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_query_queue_size","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: threads-in-use
          title: Threads In Use
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_threads_in_use","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: clickhouse-parts
      title: Parts and Merges
      panels:
        - id: parts-total
          title: Parts Total
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_parts","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: merges-in-progress
          title: Merges In Progress
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_merges","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: mutations-in-progress
          title: Mutations In Progress
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_mutations","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: clickhouse-replication
      title: Replication
      panels:
        - id: replication-queue
          title: Replication Queue Size
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_replication_queue_size","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: replication-lag
          title: Replication Lag
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_replication_lag","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: replica-errors
          title: Replica Errors
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_replica_errors","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: clickhouse-memory
      title: Memory and Cache
      panels:
        - id: memory-usage
          title: Memory Usage
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_memory_usage","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: mark-cache-hit
          title: Mark Cache Hit Ratio
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_mark_cache_hit_ratio","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: uncompressed-cache-size
          title: Uncompressed Cache Size
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_uncompressed_cache_size","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: clickhouse-storage
      title: Storage
      panels:
        - id: data-size
          title: Data Size
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_data_size","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: disk-used
          title: Disk Used
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_disk_used","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: disk-free
          title: Disk Free
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"clickhouse_disk_free","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
