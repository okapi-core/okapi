version: 1
dashboard:
  id: postgres-monitoring
  title: Postgres Monitoring
  description: Postgres connections, transactions, cache, and storage metrics.
  tags: [postgres, monitoring]
  vars:
    - name: svc
      type: SVC
    - name: service_instance_id
      type: TAG_VALUE
      tag: service_instance_id
  rows:
    - id: postgres-connections
      title: Connections
      panels:
        - id: backends-total
          title: Backends Total
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_backends","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: backends-active
          title: Backends Active
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_backends_active","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: backends-idle
          title: Backends Idle
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_backends_idle","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: max-connections
          title: Max Connections
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_max_connections","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: postgres-transactions
      title: Transactions
      panels:
        - id: xact-commits
          title: Transactions Committed
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_transactions_committed","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: xact-rollbacks
          title: Transactions Rolled Back
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_transactions_rolled_back","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: xact-total
          title: Transactions Total
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_transactions","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: postgres-rows
      title: Row Activity
      panels:
        - id: rows-returned
          title: Rows Returned
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_rows_returned","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: rows-fetched
          title: Rows Fetched
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_rows_fetched","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: rows-inserted
          title: Rows Inserted
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_rows_inserted","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: rows-updated
          title: Rows Updated
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_rows_updated","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: rows-deleted
          title: Rows Deleted
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_rows_deleted","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: postgres-cache
      title: Cache and Blocks
      panels:
        - id: blocks-read
          title: Blocks Read
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_blocks_read","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: blocks-hit
          title: Blocks Hit
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_blocks_hit","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: block-read-time
          title: Block Read Time
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_blk_read_time","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: block-write-time
          title: Block Write Time
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_blk_write_time","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: postgres-wal-temp
      title: WAL and Temp
      panels:
        - id: temp-files
          title: Temp Files
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_temp_files","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: temp-bytes
          title: Temp Bytes
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_temp_bytes","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: wal-bytes
          title: WAL Bytes
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_wal_bytes","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: checkpoints-timed
          title: Checkpoints Timed
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_checkpoints_timed","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: checkpoints-requested
          title: Checkpoints Requested
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_checkpoints_req","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: postgres-locks
      title: Locks and Conflicts
      panels:
        - id: deadlocks
          title: Deadlocks
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_deadlocks","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: conflicts
          title: Conflicts
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_conflicts","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
        - id: lock-waits
          title: Lock Waits
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_lock_waits","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
    - id: postgres-storage
      title: Storage
      panels:
        - id: db-size
          title: Database Size
          queries:
            - query: >
                {"svc":"$__{svc}","metric":"postgresql_database_size","tags":{"service_instance_id":"$__{service_instance_id}"},"start":0,"end":0,"metricType":"GAUGE","gaugeQueryConfig":{"resolution":"SECONDLY","aggregation":"AVG"}}
