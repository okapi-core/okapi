okapi:
  logs:
    dataDir: logs                # Local directory where per-tgenant/logStream files are stored
    maxPageBytes: 8388608        # Max serialized page size before flush (bytes). Default 8 MiB
    maxDocsPerPage: 20000        # Max number of log docs per page before flush
    maxPageWindowMs: 120000      # Max time window per page before flush (ms)
    maxActivePages: 10000        # Max in-memory active pages (logStream) before backpressure
    bloomFpp: 0.01               # Bloom filter false-positive probability per page
    fsyncOnPageAppend: true      # Force fsync after each page append for durability
    indexFsyncEveryPages: 1      # Fsync index every N page writes (1 = every page)
    s3Bucket: ""                 # If set, S3QueryProcessor will read from this bucket
    s3BasePrefix: logs           # Base prefix in S3 (prefix/logStream/{logfile.bin, logfile.idx})

  # Notes:
  # - Each LogPage is appended to logfile.bin and a fixed-size entry to logfile.idx.
  # - Pages contain: tsStart/tsEnd, maxDocId, trigram bitmaps, level bitmaps,
  #   a Bloom filter of traceIds, and the list of LogPayloadProto docs.
  # - A CRC32 footer is appended at the end of each page.
  # - OTLP/HTTP ingest endpoint is exposed at POST /v1/logs with headers:
  #     X-Okapi-Tenant-Id, X-Okapi-Log-Stream

  # Global response controls
  response:
    maxSize: 10000              # Max items allowed in an in-memory response list before truncation

  # Spans configuration (stored under okapi-logs module after refactor)
  traces:
    dataDir: trace-pages        # Local directory for per app span pages
    maxPageBytes: 8388608       # Max serialized page size before flush (bytes)
    maxPageWindowMs: 120000     # Max time window per page (ms)
    expectedBloomInsertions: 10000  # Bloom capacity per page
    bloomFpp: 0.01              # Bloom false-positive probability
    s3:
      basePrefix: traces        # S3 base prefix for spans (traces/{app}/{hour}/{nodeId}/)
      uploadGraceMs: 120000     # Grace past the hour before uploads
      # Use okapi.spans.bucket (preferred) or okapi.traces.s3.bucket (fallback) to set bucket
